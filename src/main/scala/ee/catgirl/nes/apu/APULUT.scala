package ee.catgirl.nes.apu

import chisel3._
import chisel3.util._

object APULUT {
  def apply(inA: UInt, inB: UInt) : UInt = {
    val mod = Module(new APULUT)
    mod.io.inA := inA
    mod.io.inB := inB
    mod.io.out
  }
}

class APULUT extends Module {
  val io = IO(new Bundle {
    val inA = Input(UInt(8.W))
    val inB = Input(UInt(8.W))
    val out = Output(UInt(16.W))
  })
  val lookup = VecInit(
    0.U(16.W),
    760.U(16.W),
    1503.U(16.W),
    2228.U(16.W),
    2936.U(16.W),
    3627.U(16.W),
    4303.U(16.W),
    4963.U(16.W),
    5609.U(16.W),
    6240.U(16.W),
    6858.U(16.W),
    7462.U(16.W),
    8053.U(16.W),
    8631.U(16.W),
    9198.U(16.W),
    9752.U(16.W),
    10296.U(16.W),
    10828.U(16.W),
    11349.U(16.W),
    11860.U(16.W),
    12361.U(16.W),
    12852.U(16.W),
    13334.U(16.W),
    13807.U(16.W),
    14270.U(16.W),
    14725.U(16.W),
    15171.U(16.W),
    15609.U(16.W),
    16039.U(16.W),
    16461.U(16.W),
    16876.U(16.W),
    0.U(16.W),
    439.U(16.W),
    874.U(16.W),
    1306.U(16.W),
    1735.U(16.W),
    2160.U(16.W),
    2581.U(16.W),
    2999.U(16.W),
    3414.U(16.W),
    3826.U(16.W),
    4234.U(16.W),
    4639.U(16.W),
    5041.U(16.W),
    5440.U(16.W),
    5836.U(16.W),
    6229.U(16.W),
    6618.U(16.W),
    7005.U(16.W),
    7389.U(16.W),
    7769.U(16.W),
    8147.U(16.W),
    8522.U(16.W),
    8895.U(16.W),
    9264.U(16.W),
    9631.U(16.W),
    9995.U(16.W),
    10356.U(16.W),
    10714.U(16.W),
    11070.U(16.W),
    11423.U(16.W),
    11774.U(16.W),
    12122.U(16.W),
    12468.U(16.W),
    12811.U(16.W),
    13152.U(16.W),
    13490.U(16.W),
    13825.U(16.W),
    14159.U(16.W),
    14490.U(16.W),
    14818.U(16.W),
    15145.U(16.W),
    15469.U(16.W),
    15791.U(16.W),
    16110.U(16.W),
    16427.U(16.W),
    16742.U(16.W),
    17055.U(16.W),
    17366.U(16.W),
    17675.U(16.W),
    17981.U(16.W),
    18286.U(16.W),
    18588.U(16.W),
    18888.U(16.W),
    19187.U(16.W),
    19483.U(16.W),
    19777.U(16.W),
    20069.U(16.W),
    20360.U(16.W),
    20648.U(16.W),
    20935.U(16.W),
    21219.U(16.W),
    21502.U(16.W),
    21783.U(16.W),
    22062.U(16.W),
    22339.U(16.W),
    22615.U(16.W),
    22889.U(16.W),
    23160.U(16.W),
    23431.U(16.W),
    23699.U(16.W),
    23966.U(16.W),
    24231.U(16.W),
    24494.U(16.W),
    24756.U(16.W),
    25016.U(16.W),
    25274.U(16.W),
    25531.U(16.W),
    25786.U(16.W),
    26040.U(16.W),
    26292.U(16.W),
    26542.U(16.W),
    26791.U(16.W),
    27039.U(16.W),
    27284.U(16.W),
    27529.U(16.W),
    27772.U(16.W),
    28013.U(16.W),
    28253.U(16.W),
    28492.U(16.W),
    28729.U(16.W),
    28964.U(16.W),
    29198.U(16.W),
    29431.U(16.W),
    29663.U(16.W),
    29893.U(16.W),
    30121.U(16.W),
    30349.U(16.W),
    30575.U(16.W),
    30800.U(16.W),
    31023.U(16.W),
    31245.U(16.W),
    31466.U(16.W),
    31685.U(16.W),
    31904.U(16.W),
    32121.U(16.W),
    32336.U(16.W),
    32551.U(16.W),
    32764.U(16.W),
    32976.U(16.W),
    33187.U(16.W),
    33397.U(16.W),
    33605.U(16.W),
    33813.U(16.W),
    34019.U(16.W),
    34224.U(16.W),
    34428.U(16.W),
    34630.U(16.W),
    34832.U(16.W),
    35032.U(16.W),
    35232.U(16.W),
    35430.U(16.W),
    35627.U(16.W),
    35823.U(16.W),
    36018.U(16.W),
    36212.U(16.W),
    36405.U(16.W),
    36597.U(16.W),
    36788.U(16.W),
    36978.U(16.W),
    37166.U(16.W),
    37354.U(16.W),
    37541.U(16.W),
    37727.U(16.W),
    37912.U(16.W),
    38095.U(16.W),
    38278.U(16.W),
    38460.U(16.W),
    38641.U(16.W),
    38821.U(16.W),
    39000.U(16.W),
    39178.U(16.W),
    39355.U(16.W),
    39532.U(16.W),
    39707.U(16.W),
    39881.U(16.W),
    40055.U(16.W),
    40228.U(16.W),
    40399.U(16.W),
    40570.U(16.W),
    40740.U(16.W),
    40909.U(16.W),
    41078.U(16.W),
    41245.U(16.W),
    41412.U(16.W),
    41577.U(16.W),
    41742.U(16.W),
    41906.U(16.W),
    42070.U(16.W),
    42232.U(16.W),
    42394.U(16.W),
    42555.U(16.W),
    42715.U(16.W),
    42874.U(16.W),
    43032.U(16.W),
    43190.U(16.W),
    43347.U(16.W),
    43503.U(16.W),
    43659.U(16.W),
    43813.U(16.W),
    43967.U(16.W),
    44120.U(16.W),
    44273.U(16.W),
    44424.U(16.W),
    44575.U(16.W),
    44726.U(16.W),
    44875.U(16.W),
    45024.U(16.W),
    45172.U(16.W),
    45319.U(16.W),
    45466.U(16.W),
    45612.U(16.W),
    45757.U(16.W),
    45902.U(16.W),
    46046.U(16.W),
    46189.U(16.W),
    46332.U(16.W),
    46474.U(16.W),
    46615.U(16.W),
    46756.U(16.W),
    46895.U(16.W),
    47035.U(16.W),
    47173.U(16.W),
    47312.U(16.W),
    47449.U(16.W),
    47586.U(16.W),
    47722.U(16.W),
    47857.U(16.W),
    47992.U(16.W),
    48127.U(16.W),
    48260.U(16.W),
    48393.U(16.W),
    48526.U(16.W),
    48658.U(16.W)
  )
  val tmpA = RegNext(lookup(Cat(0.B,io.inA)))
  val tmpB = RegNext(lookup(Cat(1.B,io.inB)))
  io.out := tmpA + tmpB
}
